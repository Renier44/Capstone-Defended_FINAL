{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Profile - SmartSight</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
    :root {
        --blue-primary: #8cd8f8;
        --blue-header: #8cd8f8;
        --blue-light: #e8f5ff;
        --text-dark: #222;
        --text-muted: #6c757d;
        --card-bg: #ffffff;
        --bg-body: #f3f9ff;
        --shadow: 0 8px 20px rgba(0, 0, 0, 0.1); /* Mas dako nga shadow */
        --border-radius: 16px;
    }

    body {
        background-color: var(--bg-body);
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        min-height: 100vh;
    }

    /* ➡️ GI-BAG-O: Gihimo nga mas lapad (80% sa screen) */
    .page-container {
        max-width: 1200px; /* Gidugangan ang max-width */
        width: 90%; /* Gidugangan ang width percentage */
        margin: 30px auto;
    }

    /* ============= PROFILE SUMMARY CARD ============= */
    .profile-summary-card {
        background: linear-gradient(135deg, var(--blue-header), var(--blue-primary));
        color: white;
        border-radius: var(--border-radius);
        padding: 35px 45px; /* Gidugangan ang padding */
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 35px;
        box-shadow: var(--shadow);
    }

    .summary-info {
        display: flex;
        align-items: center;
    }

    /* ➡️ GI-BAG-O: Gihimo nga mas dako ang avatar */
    .summary-avatar {
        width: 150px; /* Gidugangan gikan sa 110px */
        height: 150px; /* Gidugangan gikan sa 110px */
        border-radius: 50%;
        object-fit: cover;
        border: 5px solid white; /* Gidugangan ang border */
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }

    .summary-details {
        margin-left: 30px; /* Gidugangan ang margin */
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .summary-details h4 {
        font-size: 1.8rem;
        margin-bottom: 10px !important;
    }

    .summary-detail-item {
        display: flex;
        align-items: center;
        font-size: 1.0rem; /* Gidugangan ang font size */
        opacity: 0.95;
    }

    .summary-detail-item i {
        margin-right: 10px;
        font-size: 1.1rem;
    }

    .btn-summary-edit {
        background-color: white;
        color: var(--blue-primary);
        font-weight: bold;
        border: none;
        padding: 12px 25px;
        border-radius: 10px;
        transition: 0.2s;
    }

    .btn-summary-edit:hover {
        background-color: #f2f8ff;
        transform: translateY(-1px);
    }

    /* ============= INFORMATION CARD ============= */
    .info-card {
        background-color: var(--card-bg);
        border-radius: var(--border-radius);
        padding: 40px;
        box-shadow: var(--shadow);
        margin-bottom: 25px;
    }

    .info-title {
        font-size: 1.5rem; /* Gidugangan ang font size */
        font-weight: 600;
        color: var(--text-dark);
        margin-bottom: 30px;
        border-bottom: 2px solid var(--blue-light);
        padding-bottom: 12px;
    }

    .detail-item-wrapper {
        margin-bottom: 25px;
    }

    .detail-label {
        font-size: 0.9rem;
        font-weight: 500;
        color: var(--text-muted);
        margin-bottom: 8px;
        display: block;
    }

    .detail-value {
        background-color: var(--blue-light);
        border-radius: 12px;
        padding: 14px 20px;
        font-weight: 600;
        color: var(--text-dark);
        min-height: 50px;
        display: flex;
        align-items: center;
    }

    .detail-value i {
        margin-right: 10px;
        color: var(--blue-primary);
    }

    /* ============= IMAGE UPLOAD AREA ============= */
    .upload-area {
        border: 2px dashed var(--blue-primary);
        background-color: #f4faff;
        border-radius: 16px;
        padding: 40px;
        text-align: center;
        cursor: pointer;
        transition: 0.3s;
    }
    
    .upload-area:hover {
        background-color: #e9f5ff;
        border-color: var(--blue-header);
    }

    .upload-area i {
        font-size: 2.5rem;
        color: var(--blue-primary);
        margin-bottom: 15px;
    }

    /* ============= MODALS ============= */
    .modal-header {
        background-color: var(--blue-primary);
        color: white;
        border-top-left-radius: 12px;
        border-top-right-radius: 12px;
    }

    .btn-save-changes {
        background-color: var(--blue-primary);
        color: white;
        font-weight: 600;
        border-radius: 8px;
        padding: 10px 25px;
        border: none;
    }

    .btn-save-changes:hover {
        background-color: #156bb5;
    }
</style>

</head>
<body>

<div class="page-container">
    <h2 class="mb-5">Profile Management</h2> <div class="profile-summary-card">
        <div class="summary-info">
            <img 
                src="{% if user.adminprofile.profile_image %}{{ user.adminprofile.profile_image.url }}{% else %}{% static 'images/default_admin.png' %}{% endif %}" 
                alt="Admin Avatar" 
                class="summary-avatar"
            >
            
            <div class="summary-details">
                <h4 class="mb-0">{{ user.first_name|default:user.username }} {{ user.last_name|default:'' }}</h4>
                
                <div class="summary-detail-item d-none d-md-flex">
                    <i class="fas fa-envelope"></i>
                    <span>{{ user.email }}</span> 
                </div>
                <div class="summary-detail-item d-none d-md-flex">
                    <i class="fas fa-phone"></i>
                    <span>{{ user.adminprofile.phone_number|default:"N/A" }}</span>
                </div>
                <div class="summary-detail-item d-none d-md-flex">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>{{ user.adminprofile.address|default:"N/A" }}</span>
                </div>
            </div>
        </div>
        
        <button type="button" class="btn btn-summary-edit" data-bs-toggle="modal" data-bs-target="#editProfileModal">
            <i class="fas fa-cog me-1"></i> Edit Details
        </button>
    </div>

    {% if messages %}
    <div class="alert-container mb-4">
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}
    </div>
    {% endif %}


    <div class="info-card">
        <h3 class="info-title">Personal Information</h3>
        
        <div class="row">
            <div class="col-md-6">
                <div class="detail-item-wrapper">
                    <span class="detail-label">First Name</span>
                    <div class="detail-value">{{ user.first_name|default:'N/A' }}</div>
                </div>
                <div class="detail-item-wrapper">
                    <span class="detail-label">Phone Number</span>
                    <div class="detail-value">
                        <i class="fas fa-phone"></i>
                        {{ user.adminprofile.phone_number|default:"N/A" }}
                    </div>
                </div>
                <div class="detail-item-wrapper">
                    <span class="detail-label">Date Joined</span>
                    <div class="detail-value">
                         <i class="fas fa-clock"></i>
                        {{ user.date_joined|date:"F d, Y" }}
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="detail-item-wrapper">
                    <span class="detail-label">Last Name</span>
                    <div class="detail-value">{{ user.last_name|default:'N/A' }}</div>
                </div>
                <div class="detail-item-wrapper">
                    <span class="detail-label">Location / Address</span>
                    <div class="detail-value">
                        <i class="fas fa-map-marker-alt"></i>
                        {{ user.adminprofile.address|default:"N/A" }}
                    </div>
                </div>
                <div class="detail-item-wrapper">
                    <span class="detail-label">Role / Last Login</span>
                    <div class="detail-value">
                        <i class="fas fa-sign-in-alt"></i>
                        {% if user.is_staff %}System Admin (Last Login: {{ user.last_login|date:"F d, Y P" }}){% else %}User{% endif %}
                    </div>
                </div>
            </div>
            
            <div class="col-12 mt-4">
                <span class="detail-label">Profile Picture</span>
                <div class="upload-area" data-bs-toggle="modal" data-bs-target="#imageUploadModal">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <div>
                        <a href="#" onclick="return false;">**Click to upload**</a> or drag & drop
                    </div>
                    <small class="text-muted">Max resolution 200x200px (Recommended)</small>
                </div>
            </div>
        </div>
    </div>
    
    <a href="{% url 'admin_home' %}" class="btn btn-outline-secondary w-100 mt-4 py-2">
        <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
    </a>
</div>

<div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editProfileModalLabel"><i class="fas fa-edit me-2"></i>Edit Admin Details</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editProfileForm" method="POST" action="{% url 'admin_update_profile' %}">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="id_username" class="form-label">Username</label>
                        <input type="text" class="form-control" id="id_username" name="username" value="{{ user.username }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="id_email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="id_email" name="email" value="{{ user.email }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="id_first_name" class="form-label">First Name</label>
                        <input type="text" class="form-control" id="id_first_name" name="first_name" value="{{ user.first_name|default:'' }}">
                    </div>
                    <div class="mb-3">
                        <label for="id_last_name" class="form-label">Last Name</label>
                        <input type="text" class="form-control" id="id_last_name" name="last_name" value="{{ user.last_name|default:'' }}">
                    </div>
                    <div class="mb-3">
                        <label for="id_phone" class="form-label">Phone Number</label>
                        <input type="text" class="form-control" id="id_phone" name="phone_number" value="{{ user.adminprofile.phone_number|default:'' }}">
                    </div>
                    <div class="mb-3">
                        <label for="id_address" class="form-label">Address</label>
                        <input type="text" class="form-control" id="id_address" name="address" value="{{ user.adminprofile.address|default:'' }}">
                    </div>
                    <small class="text-muted">Changes may require you to log in again.</small>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-save-changes">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="imageUploadModal" tabindex="-1" aria-labelledby="imageUploadModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="imageUploadModalLabel"><i class="fas fa-camera me-2"></i>Change Photo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="uploadImageForm" method="POST" enctype="multipart/form-data" action="{% url 'admin_update_profile_image' %}">
                {% csrf_token %}
                <div class="modal-body text-center">
                    <p class="text-muted">Select a new profile image.</p>
                    <input type="file" class="form-control" id="id_profile_image" name="profile_image" accept="image/*" required>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-save-changes">Upload</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const uploadArea = document.querySelector('.upload-area');
        const imageUploadModal = new bootstrap.Modal(document.getElementById('imageUploadModal'));
        if (uploadArea) {
            uploadArea.addEventListener('click', function() {
                imageUploadModal.show();
            });
        }
    });
</script>
</body>
</html>